(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('web-audio-beat-detector-broker')) :
	typeof define === 'function' && define.amd ? define(['exports', 'web-audio-beat-detector-broker'], factory) :
	(global = global || self, factory(global.webAudioBeatDetector = {}, global.webAudioBeatDetectorBroker));
}(this, function (exports, webAudioBeatDetectorBroker) { 'use strict';

	// tslint:disable-next-line:max-line-length
	var worker = "!function(r){var n={};function o(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=r,o.c=n,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var n in t)o.d(r,n,function(e){return t[e]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,\"a\",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p=\"\",o(o.s=0)}([function(e,t,r){\"use strict\";r.r(t);r(1)},function(e,t,r){!function(p){\"use strict\";p=p&&p.hasOwnProperty(\"default\")?p.default:p;var h=function(e,t,r){for(var n=e.length,o=[],a=!1,u=0;u<n;u+=1)e[u]>t?a=!0:a&&(a=!1,o.push(u-1),u+=r/4-1);return a&&o.push(n-1),o},d=function(e,t){var r=function(e){for(var t=0,r=e.length,n=0;n<r;n+=1)e[n]>t&&(t=e[n]);return t}(e),n=.3*r,o=[],a=r-.05*r;if(.25<r)for(;o.length<30&&n<=a;)o=h(e,a,t),a-=.05*r;var u,s,i,f,c=(s=[],(u=o).forEach(function(r,n){for(var e=Math.min(u.length-n,10),t=function(e){var t=u[n+e]-r;s.some(function(e){return e.interval===t&&(e.peaks.push(r),!0)})||s.push({interval:t,peaks:[r]})},o=1;o<e;o+=1)t(o)}),s),l=(i=t,f=[],c.forEach(function(r){for(var n=60/(r.interval/i);n<90;)n*=2;for(;180<n;)n/=2;var o=!1,a=r.peaks.length;f.forEach(function(e){if(e.tempo===n&&(e.score+=r.peaks.length,e.peaks=[].concat(p(e.peaks),p(r.peaks)),o=!0),e.tempo>n-.5&&e.tempo<n+.5){var t=2*Math.abs(e.tempo-n);a+=(1-t)*e.peaks.length,e.score+=(1-t)*r.peaks.length}}),o||f.push({peaks:r.peaks,score:a,tempo:n})}),f);return l.sort(function(e,t){return t.score-e.score}),l};addEventListener(\"message\",function(e){var t=e.data;try{if(\"analyze\"===t.method){var r=t.id,n=t.params,o=n.channelData,a=n.sampleRate,u=function(e,t){var r=d(e,t);if(0!==r.length)return r[0].tempo;throw new Error(\"The given channelData does not contain any detectable beats.\")}(o,a);postMessage({error:null,id:r,result:{tempo:u}})}else{if(\"guess\"!==t.method)throw new Error('The given method \"'.concat(t.method,'\" is not supported'));var s=t.id,i=t.params,f=i.channelData,c=i.sampleRate,l=function(e,t){var r=d(e,t);if(0===r.length)throw new Error(\"The given channelData does not contain any detectable beats.\");var n=r[0],o=n.peaks,a=n.tempo,u=Math.round(a),s=60/u;o.sort(function(e,t){return e-t});for(var i=o[0]/t;s<i;)i-=s;return{bpm:u,offset:i}}(f,c),p=l.bpm,h=l.offset;postMessage({error:null,id:s,result:{bpm:p,offset:h}})}}catch(e){postMessage({error:{message:e.message},id:t.id,result:null})}})}(r(2))},function(e,t,r){var n=r(3),o=r(4),a=r(5);e.exports=function(e){return n(e)||o(e)||a()}},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance\")}}]);";

	var blob = new Blob([worker], {
	  type: 'application/javascript; charset=utf-8'
	});
	var url = URL.createObjectURL(blob);
	var webAudioBeatDetector = webAudioBeatDetectorBroker.load(url);
	var analyze = webAudioBeatDetector.analyze;
	var guess = webAudioBeatDetector.guess;
	URL.revokeObjectURL(url);

	exports.analyze = analyze;
	exports.guess = guess;

	Object.defineProperty(exports, '__esModule', { value: true });

}));
